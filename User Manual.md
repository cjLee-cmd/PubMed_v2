# 사용자 매뉴얼 (User Manual)

버전: 1.0.0  
최종 수정: 2025-08-23  
대상: Acuzenic PubMed 검색/결과 내보내기 & 로컬 사용자 관리 웹 도구 일반 사용자 / 마스터 사용자

---
## 1. 소개
이 도구는 웹 브라우저에서 PubMed 논문을 빠르게 검색·확인·내보내기 할 수 있게 해주는 경량 클라이언트임.  
검색식(키워드 그룹 + AND/OR 논리 + 발행일 기간)을 시각적으로 구성하고, 결과를 표로 확인 후 JSON / Excel / PDF 형식으로 저장 가능.  
게스트/일반 사용자/마스터(관리자) 3가지 역할 기반의 단순 인증 기능 포함.

---
## 2. 사용자 역할 요약
| 역할 | 권한 요약 | 비고 |
|------|-----------|------|
| 게스트 (guest) | 검색 및 결과 내보내기 가능 | 사용자 데이터(계정) 저장 없음 |
| 일반 사용자 (user) | 게스트 기능 + 로그인 상태 유지 | 회원가입 후 사용 |
| 마스터 (master) | 사용자 관리(목록/삭제/엑셀 내보내기/업로드) + 검색 | 초기 기본 계정 제공 |

---
## 3. 빠른 시작 (Quick Start)
1. 브라우저(Chrome/Edge/Firefox 최신)에서 `index.html` 열기 (호스팅 환경이라면 해당 URL 접속).
2. (선택) 회원가입 → 로그인 OR 게스트 입장.
3. `main.html` 화면에서 키워드 입력, AND/OR 설정, 필요 시 날짜 범위 선택.
4. [Search] 버튼 클릭 → 결과 표 확인.
5. 필요 시 JSON / Excel / PDF 저장.
6. 새 검색어 조합·수정 후 반복.

---
## 4. 로그인 & 계정 관리
### 4.1 로그인
- `index.html` → 사용자 ID / 비밀번호 입력 후 로그인.
- 로그인 성공 시: user → `main.html` 이동, master → 같은 페이지에서 마스터 패널 표시.

### 4.2 회원가입(일반 사용자)
입력 필드:
- 사용자 ID: 4~20자 영문/숫자
- 비밀번호: 8자 이상 (영문/숫자 조합 권장)
- 이메일: 유효 이메일 형식
- 이름: 자유 입력

### 4.3 게스트 모드
- 로그인 없이 즉시 사용.
- 세션(브라우저 탭) 종료 시 상태 사라짐.

### 4.4 마스터 패널 기능
- 사용자 목록 조회
- 사용자 삭제(마스터 계정 제외)
- 현재 사용자 목록 Excel 다운로드
- 샘플(초기) 사용자 엑셀 템플릿 생성
- 외부에서 편집한 사용자 엑셀 업로드 → 신규 사용자 병합 또는 교체

> 보안 주의: 현재 비밀번호는 해시되지 않고 평문 저장(프로토타입 목적). 운영 전 반드시 서버 측 해시/검증 구조 도입 권장.

---
## 5. 메인 화면 구성 (main.html)
| 영역 | 설명 |
|------|------|
| 검색 조건 설정 패널(좌) | 키워드 그룹, 날짜 필터, 검색 조건 미리보기, Search 버튼 |
| 결과 패널(우) | 검색 결과 표, 내보내기 버튼(JSON/Excel/PDF) |
| 헤더 | 사용자 정보 / 로그아웃 |

### 5.1 키워드 그룹
- 각 그룹 = [키워드 입력] + [📋 복사] + [📄 붙여넣기] + [AND] + [OR] + [Delete]
- 첫 키워드 입력 후 AND/OR 선택하면 자동으로 새 빈 그룹 생성
- 빈 그룹은 검색식에 포함되지 않음
- 큰따옴표 자동 적용되어 정확/구체 검색 유도

### 5.2 논리 연산
- 그룹 간 관계는 바로 앞 그룹의 활성 AND/OR 버튼 기준
- 연속된 논리 연산자 또는 마지막 위치 연산자 방지: 유효성 검사 수행

### 5.3 날짜(발행 기간) 필터
- [기간 필터 사용] 체크 → 시작일/종료일 입력 활성화
- 조합:
  - 시작 + 종료 → 해당 범위
  - 시작만 → 시작일 ~ 3000년
  - 종료만 → 1800년 ~ 종료일
- PubMed `Date - Publication` 필드 구문 형식으로 내부 변환 (YYYY/MM/DD)

### 5.4 검색 조건 미리보기 (Summary)
- 실시간 검색식 표시
- 5개 토큰마다 줄바꿈 적용 (가독성)
- 복사(📋) / 붙여넣기(📄) 지원
- 붙여넣은 전체 검색식을 역파싱 → 키워드 그룹 & 날짜 필터 자동 복원

---
## 6. 검색 과정
1. 사용자 입력 → buildSearchQuery()로 문자열 구성
2. validateSearchQuery()로 형식 검증
3. NCBI E-utilities 호출 (순차)
   - esearch: PMID 목록 (retmax=10 기본)
   - esummary: 메타데이터(title, authors, source, pubdate)
   - efetch: abstract 텍스트
4. 결과 결합 후 표 렌더
5. Abstract 길이 > 180자 → [더보기] 버튼 → 모달 전체 표시

> 참고: retmax=10은 프로토타입 기본값. 대량 검색 필요 시 코드 수정 또는 UI 옵션 추가 필요.

---
## 7. 결과 내보내기
| 포맷 | 내용 | 특징 |
|------|------|------|
| JSON | 객체 배열 (pmid, title, authors, source, pubdate, abstract) | 구조 보존, 재활용 용이 |
| Excel (XLSX) | SheetJS 기반 Results 시트 | 컬럼 너비 자동 추정, 긴 셀 자르기(cut) 처리 |
| PDF | 검색 메타(시간/사용자/레코드 수/쿼리) + 표 | html2pdf.js 사용, Abstract 500자 축약 |
| CSV (Fallback) | Excel 실패 시 대체 | 초록 1000자 제한, BOM 포함(한글 안정) |

### 7.1 파일명 규칙
- `pubmed_results_YYYYMMDD_HHMM.ext`

### 7.2 PDF 포함 메타데이터
- Generated 시간, Search Date, User, Records 수, 완전 검색식

### 7.3 실패 처리
- XLSX 라이브러리 로드 실패 → Alert + CSV 시도 권장
- Excel 저장 중 오류 → Toast + CSV 자동 시도 가능

---
## 8. 복사/붙여넣기 & 단축키
| 위치 | 기능 | 단축키 (Win/Mac) |
|------|------|------------------|
| 키워드 입력 | 복사 / 붙여넣기 | Ctrl/⌘ + C / V |
| Summary 박스 | 전체 검색식 복사·붙여넣기 | Ctrl/⌘ + C / V |
| 컨텍스트 메뉴 | 우클릭 → 맞춤 메뉴 | 마우스 우클릭 |

> 붙여넣은 검색식은 키워드/연산자/날짜 조건 자동 복원.

---
## 9. 모달 & 토스트
| 요소 | 역할 | 닫기 방법 |
|------|------|------------|
| Abstract 모달 | 긴 초록 전체 보기 | 닫기 버튼 / 배경 클릭 |
| Toast | 작업 결과(복사/저장 등) 2초 표시 | 자동 사라짐 |

---
## 10. 오류 및 메시지
| 상황 | 표시 | 조치 |
|------|------|------|
| 검색 결과 없음 | "검색 결과가 없습니다" | 키워드/날짜 범위 조정 |
| 논리 오류 | Alert("연산자 위치 오류") | Summary 확인 후 수정 |
| 네트워크/API 실패 | 빨간 오류 메시지 | 잠시 후 재시도 / 네트워크 확인 |
| XLSX 로드 실패 | Alert 안내 | 새로고침 / 인터넷 확인 / CSV 사용 |
| 클립보드 접근 실패 | Toast 안내 | 브라우저 권한 확인 or 수동 복사 |

---
## 11. 보안 및 개인정보 주의
현재 구조는 로컬 스토리지 기반 프로토타입임:
- 비밀번호 평문 저장 (운영 전 반드시 해시 + 서버 검증 필요)
- API Key 클라이언트 노출 (실서비스 시 서버 프록시 권장)
- 권한 검증 클라이언트만 수행 (위변조 위험)
- 로그인 세션: sessionStorage (탭/브라우저 닫으면 소멸)

---
## 12. 고급 활용 팁
| 목적 | 팁 |
|------|----|
| 다수 키워드 빠른 구성 | 외부에서 "\"AAA\" AND \"BBB\" OR \"CCC\"" 형태 문자열 붙여넣기 |
| 기간 반복 실험 | 날짜 필터만 수정 후 즉시 Search (키워드 유지) |
| 발표 최신 논문 | 시작일을 최근 1년으로 설정 (예: 2024-08-01) |
| 결과 수 늘리기 | script.js retmax=10 → 50 등 조정 (주의: 호출량 증가) |
| 초록 전문 확보 | efetch rettype 조합 변경/추가 구현 (XML 활용) |

---
## 13. 자주 묻는 질문 (FAQ)
Q1. 검색이 항상 10건만 나옴 → A: retmax=10 고정, 코드 수정 필요.  
Q2. Excel 버튼 비활성 상태 유지 → A: 먼저 검색 실행하여 결과 확보해야 함.  
Q3. PDF 한글 깨짐 → A: html2pdf 기본 폰트 제한. 웹폰트 임베딩 개선 예정.  
Q4. 붙여넣기 했는데 날짜 안 나옴 → A: 정규식 패턴과 일치하는 구문인지 확인 (형식 유지 필요).  
Q5. 마스터 비밀번호 변경? → A: 현재 UI 미지원. localStorage userDatabase 수정 또는 코드 보강 필요.  
Q6. 비밀번호 보안 문제? → A: 프로토타입. 운영 전 해시/서버 검증 필수.  
Q7. 검색식에 NOT 쓰고 싶음 → A: UI 미구현. Summary에 수동 입력 후 붙여넣기 방식 우회 가능하나 파싱 복원 지원 X.  
Q8. 모바일에서 표 가로 스크롤? → A: CSS overflow-x 활용(기본 브라우저 동작) 확대 기능 고려.

---
## 14. 용어
| 용어 | 설명 |
|------|------|
| PMID | PubMed 고유 식별자 |
| Abstract | 논문 초록(요약) |
| E-utilities | NCBI 제공 REST API 집합 |
| esearch | 논문 ID 검색 엔드포인트 |
| esummary | 메타데이터 요약 엔드포인트 |
| efetch | 상세(초록 등) 가져오는 엔드포인트 |

---
## 15. 향후 개선 로드맵(요약)
1. 서버 기반 인증 & 비밀번호 해시
2. 고급 검색 UI (괄호/NOT/필드 제한)
3. 페이지네이션 + Lazy Load
4. XML 파싱 통한 구조화 강화
5. 사용자 활동 로그(검색 이력) 저장(옵션)
6. 국제화(i18n) 다국어 UI
7. PDF 폰트 임베딩 및 선택적 전체 초록 포함
8. 자동 테스트(Jest/Playwright) 도입

---
## 16. 문제 해결 체크리스트
| 증상 | 즉시 점검 |
|------|-----------|
| 결과 0건 | (1) 오타 (2) 기간 과도 제한 (3) 너무 구체 키워드 |
| Excel 다운로드 안 됨 | (1) 콘솔 오류 (2) 라이브러리 로드 로그 (3) CSV 대체 |
| 붙여넣기 파싱 실패 | (1) 큰따옴표 짝 (2) 불필요 줄바꿈 제거 |
| 초록 "초록 없음" 표시 | efetch 매칭 실패 가능 → PMID 열 링크로 직접 확인 |
| PDF 깨짐 | 다른 브라우저 시도 or 폰트 임베딩 개선 대기 |

---
## 17. 변경 이력 (Changelog)
| 날짜 | 버전 | 내용 |
|------|------|------|
| 2025-08-23 | 1.0.0 | 최초 사용자 매뉴얼 작성 |

---
## 18. 면책
해당 도구는 프로토타입/내부 연구 지원 용도로 제작됨. 임상/규제 의사결정 등 중요 목적 사용 전 데이터 정확성·완전성 별도 검증 필요.

---
## 19. 연락/피드백
개선 요청, 버그 제보, 기능 제안은 저장소 이슈(또는 내부 채널)를 통해 제출 권장.

끝.
